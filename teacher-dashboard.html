<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Dashboard</title>
  <link rel="stylesheet" href="./style.css">

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="firebase.js"></script>
</head>
<body>

<header>
  <h1>ğŸ‘©â€ğŸ« Teacher Dashboard</h1>
  <button class="btn logout" onclick="signOutUser()">Logout</button>
</header>

<div class="sidebar">
  <button onclick="showSection('classes-section')">My Classes</button>
  <button onclick="showSection('attendance-section')">Attendance</button>
</div>

<div class="main">
  <div id="classes-section">
    <h2>My Classes</h2>
    <div id="classes-list"></div>
    <button class="btn" onclick="addClass()">+ Add Class</button>
  </div>

  <div id="attendance-section" style="display:none;">
    <h2>Attendance</h2>
    <h3 id="class-title">Select a class to mark attendance</h3>
    <div id="attendance-list"></div>
    <button class="btn print-btn" onclick="printReport()">Print/Download Report</button>
  </div>
</div>

<script>
checkAuth();
const classesList = document.getElementById("classes-list");
const attendanceList = document.getElementById("attendance-list");
const classTitle = document.getElementById("class-title");
let currentClass = "";

function showSection(sectionId){
  document.getElementById('classes-section').style.display='none';
  document.getElementById('attendance-section').style.display='none';
  document.getElementById(sectionId).style.display='block';
}

// Load classes
function loadClasses(){
  const uid = auth.currentUser.uid;
  database.ref("teachers/"+uid+"/classes").on("value", snap=>{
    classesList.innerHTML="";
    snap.forEach(child=>{
      const btn = document.createElement("button");
      btn.textContent = child.key;
      btn.className="btn";
      btn.onclick = ()=>loadAttendance(child.key);
      classesList.appendChild(btn);
    });
  });
}
loadClasses();

function addClass(){
  const cname = prompt("Enter class name:");
  if(!cname) return;
  const uid = auth.currentUser.uid;
  database.ref("teachers/"+uid+"/classes/"+cname).set({createdAt:Date.now()});
}

// Load Attendance
function loadAttendance(cname){
  currentClass=cname;
  showSection('attendance-section');
  classTitle.textContent="Class: "+cname;
  attendanceList.innerHTML="";
  const uid=auth.currentUser.uid;
  database.ref("teachers/"+uid+"/classes/"+cname+"/students").once("value", snap=>{
    if(!snap.exists()){attendanceList.innerHTML="No students added."; return;}
    snap.forEach(studentSnap=>{
      const student = studentSnap.val();
      const div = document.createElement("div");
      div.className="student-row";
      div.innerHTML=`
        <span>${student.name||"No Name"} (Roll: ${studentSnap.key})</span>
        <div>
          <button class="btn present" onclick="markAttendance('${studentSnap.key}','present',this)">Present</button>
          <button class="btn absent" onclick="markAttendance('${studentSnap.key}','absent',this)">Absent</button>
        </div>
      `;
      attendanceList.appendChild(div);
    });
  });
}

function markAttendance(sid,status,btn){
  const uid=auth.currentUser.uid;
  const date=new Date().toISOString().split('T')[0];
  database.ref(`teachers/${uid}/classes/${currentClass}/attendance/${date}/${sid}`).set(status);
  const parent=btn.parentElement;
  parent.querySelectorAll('button').forEach(b=>b.style.opacity=0.6);
  btn.style.opacity=1;
}

function printReport(){
  const report = attendanceList.innerHTML;
  const newWin=window.open("","Print","width=800,height=600");
  newWin.document.write(`<html><head><title>Attendance Report</title></head><body>${report}</body></html>`);
  newWin.document.close();
  newWin.print();
}
</script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script src="./firebase.js"></script>
</body>
</html>
