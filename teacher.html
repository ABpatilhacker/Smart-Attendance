<!-- teacher.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Dashboard</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="firebase.js"></script>
</head>
<body>
<div class="sidebar">
  <h2>üë®‚Äçüè´ Teacher</h2>
  <a href="#" onclick="loadClasses()">My Classes</a>
  <a href="#" class="logout-btn" onclick="auth.signOut().then(()=>window.location='index.html')">Logout</a>
</div>

<div class="main-content" id="main-content">
  <h2>My Classes</h2>
  <div id="class-list"></div>
</div>

<script>
let currentTeacherId="";
auth.onAuthStateChanged(user=>{
  if(!user) window.location='login.html';
  currentTeacherId=user.uid;
  loadClasses();
});

function loadClasses(){
  database.ref(`teachers/${currentTeacherId}/classes`).once('value', snap=>{
    const div=document.getElementById("class-list");
    div.innerHTML="";
    snap.forEach(c=>{
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`<h4>${c.key}</h4>
        <button class="btn" onclick="viewClass('${c.key}')">View Students</button>
        <button class="btn" onclick="addStudentForm('${c.key}')">Add Student</button>`;
      div.appendChild(card);
    });
  });
}

// View students
function viewClass(className){
  const studentDiv=document.getElementById("main-content");
  studentDiv.innerHTML=`<h3>${className} Students</h3><div id="students-list"></div>`;
  database.ref(`teachers/${currentTeacherId}/classes/${className}/students`).once("value", snap=>{
    const list=document.getElementById("students-list");
    snap.forEach(s=>{
      const stu=s.val();
      const div=document.createElement("div");
      div.innerHTML=`${stu.name} (Roll: ${s.key})
        <button class="btn present" onclick="mark('${className}','${s.key}','present',this)">Present</button>
        <button class="btn absent" onclick="mark('${className}','${s.key}','absent',this)">Absent</button>`;
      list.appendChild(div);
    });
  });
}

// Mark attendance
function mark(className, roll, status, btn){
  const date=new Date().toISOString().split('T')[0];
  database.ref(`teachers/${currentTeacherId}/classes/${className}/attendance/${date}/${roll}`).set(status);
  btn.style.background=status==='present'?'#4CAF50':'#f44336';
}

// Add student
function addStudentForm(className){
  const div=document.getElementById("main-content");
  div.innerHTML=`<h3>Add Student to ${className}</h3>
    <input type="text" id="sname" placeholder="Student Name">
    <input type="text" id="sroll" placeholder="Roll Number">
    <button class="btn" onclick="addStudent('${className}')">Add</button>`;
}
function addStudent(className){
  const name=document.getElementById("sname").value;
  const roll=document.getElementById("sroll").value;
  database.ref(`teachers/${currentTeacherId}/classes/${className}/students/${roll}`).set({name});
  database.ref(`students/${roll}`).set({name, rollNumber:roll});
  alert("Student added!");
  loadClasses();
}
</script>
</body>
</html>
